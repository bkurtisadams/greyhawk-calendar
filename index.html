<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greyhawk Wars Campaign Calendar</title>
    <style>
        body {
            font-family: 'Bookman Old Style', Garamond, serif;
            background-color: #f5f1e6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #8b4513;
            padding-bottom: 20px;
            background-image: url('/api/placeholder/1200/200');
            background-position: center;
            background-size: cover;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            padding: 40px 20px;
            border-radius: 5px;
        }

        h1 {
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        h2 {
            color: #5a3827;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 30px;
        }

        .campaign-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .campaign-block {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border: 1px solid #d3c7a7;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .current-date {
            background-color: #8b4513;
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }

        .campaign-year {
            font-size: 1.5em;
            font-weight: bold;
            color: #5a3827;
            margin: 25px 0 15px;
            text-align: center;
        }

        .month-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .month-card {
            background-color: #fff;
            border: 1px solid #d3c7a7;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .month-card h3 {
            color: #5a3827;
            margin-top: 0;
            text-align: center;
            border-bottom: 1px solid #e9e0cc;
            padding-bottom: 10px;
        }

        .month-card .festival {
            background-color: #f0e6c8;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .day-header {
            text-align: center;
            font-weight: bold;
            background-color: #e9e0cc;
            padding: 5px;
            border-radius: 3px;
        }

        .calendar-day {
            text-align: center;
            padding: 5px;
            border: 1px solid #e9e0cc;
            border-radius: 3px;
            min-height: 30px;
            position: relative;
        }

        .calendar-day.holiday {
            background-color: #ead4b9;
            border-color: #d9b382;
            font-weight: bold;
        }

        .calendar-day.adventure {
            background-color: #d4e6f1;
            border-color: #85c1e9;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-day.battle {
            background-color: #f5b7b1;
            border-color: #e74c3c;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-day.npc-event {
            background-color: #d5f5e3;
            border-color: #58d68d;
            font-weight: bold;
            cursor: pointer;
        }

        .calendar-day.current-day {
            box-shadow: 0 0 0 2px #5a3827;
        }

        .day-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
        }

        .adventure-marker {
            background-color: #3498db;
        }

        .battle-marker {
            background-color: #e74c3c;
        }

        .npc-marker {
            background-color: #2ecc71;
        }

        .holiday-list {
            margin-top: 30px;
        }

        .holiday-item, .event-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dotted #d3c7a7;
        }

        .holiday-date, .event-date {
            font-weight: bold;
            color: #8b4513;
        }

        .toggle-view {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .toggle-view button {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-view button:hover {
            background-color: #6a2f08;
        }

        .toggle-view button.active {
            background-color: #5a3827;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .event-filters {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .event-filter {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }

        .event-filter input {
            margin-right: 5px;
        }

        .color-box {
            width: 15px;
            height: 15px;
            display: inline-block;
            margin-right: 5px;
            border-radius: 3px;
        }

        .color-adventure {
            background-color: #d4e6f1;
        }

        .color-battle {
            background-color: #f5b7b1;
        }

        .color-npc {
            background-color: #d5f5e3;
        }

        .color-holiday {
            background-color: #ead4b9;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .modal-content {
            background-color: #f5f1e6;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #d3c7a7;
            width: 80%;
            max-width: 800px;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .event-title {
            color: #5a3827;
            border-bottom: 1px solid #d3c7a7;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .event-meta {
            font-style: italic;
            color: #777;
            margin-bottom: 20px;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .character-card {
            background-color: #fff;
            border: 1px solid #d3c7a7;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .character-card h3 {
            margin-top: 0;
            border-bottom: 1px solid #e9e0cc;
            padding-bottom: 5px;
        }

        .character-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px 15px;
        }

        .character-stat {
            display: flex;
            justify-content: space-between;
        }

        .character-bio {
            margin-top: 10px;
            font-style: italic;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9em;
            color: #777;
            border-top: 1px solid #d3c7a7;
            padding-top: 20px;
        }

        /* Tabs in event modal */
        .event-tabs {
            display: flex;
            border-bottom: 1px solid #d3c7a7;
            margin-bottom: 20px;
        }

        .event-tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #e9e0cc;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }

        .event-tab.active {
            background-color: #8b4513;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Timeline view */
        .timeline {
            position: relative;
            max-width: 1200px;
            margin: 20px auto;
        }

        .timeline::after {
            content: '';
            position: absolute;
            width: 6px;
            background-color: #8b4513;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -3px;
        }

        .timeline-container {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }

        .timeline-container::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            right: -10px;
            background-color: white;
            border: 4px solid #8b4513;
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }

        .timeline-left {
            left: 0;
        }

        .timeline-right {
            left: 50%;
        }

        .timeline-right::after {
            left: -10px;
        }

        .timeline-content {
            padding: 20px;
            background-color: white;
            position: relative;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .timeline-content h3 {
            margin-top: 0;
            color: #5a3827;
        }

        .timeline-content .event-date {
            display: inline-block;
            margin-bottom: 10px;
        }

        /* Year navigation */
        .year-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .year-navigation button {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .year-navigation .current-cy {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 20px;
        }

        /* Content editor */
        .admin-controls {
            margin: 20px 0;
            padding: 15px;
            background-color: #e9e0cc;
            border-radius: 5px;
            display: none;
        }

        .admin-controls.visible {
            display: block;
        }

        .admin-section {
            margin-bottom: 15px;
        }

        .admin-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .admin-section input[type="text"],
        .admin-section select,
        .admin-section textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #d3c7a7;
            border-radius: 4px;
        }

        .admin-section textarea {
            min-height: 100px;
        }

        .admin-buttons {
            display: flex;
            justify-content: space-between;
        }

        .admin-button {
            background-color: #8b4513;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        .admin-button.save {
            background-color: #2ecc71;
        }

        .admin-button.delete {
            background-color: #e74c3c;
        }

        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #5a3827;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            z-index: 100;
        }
    </style>
</head>
<body>
    <header>
        <h1>Greyhawk Wars Campaign</h1>
        <p>Campaign Timeline and Event Tracker - 567 CY to 569 CY</p>
    </header>

    <div class="campaign-info">
        <div class="campaign-block">
            <h2>Campaign Overview</h2>
            <p>This campaign follows our heroes through the tumultuous events of the Greyhawk Wars, beginning in 567 CY. The conflict has spread across the Flanaess, drawing in nations from the Baklunish West to the Solnor Ocean.</p>
        </div>
        <div class="campaign-block">
            <h2>Current Status</h2>
            <p>The party is currently in the Kingdom of Nyrond, investigating rumors of Iuz's agents infiltrating the royal court. Last session ended with the discovery of a secret passage beneath Castle Rel Mord.</p>
        </div>
    </div>

    <div class="current-date" id="current-date">
        Loading current campaign date...
    </div>

    <div class="toggle-view">
        <button id="btn-calendar" class="active">Calendar View</button>
        <button id="btn-timeline">Timeline</button>
        <button id="btn-characters">Character Sheets</button>
        <button id="btn-months">Greyhawk Months</button>
        <button id="btn-holidays">Holidays & Festivals</button>
    </div>

    <div id="calendar-view" class="view active">
        <div class="year-navigation">
            <button id="prev-year">◀ Prev Year</button>
            <div class="current-cy" id="display-year">568 CY</div>
            <button id="next-year">Next Year ▶</button>
        </div>
        
        <div class="event-filters">
            <div class="event-filter">
                <input type="checkbox" id="filter-holiday" checked>
                <span class="color-box color-holiday"></span>
                <label for="filter-holiday">Holidays</label>
            </div>
            <div class="event-filter">
                <input type="checkbox" id="filter-adventure" checked>
                <span class="color-box color-adventure"></span>
                <label for="filter-adventure">Adventures</label>
            </div>
            <div class="event-filter">
                <input type="checkbox" id="filter-battle" checked>
                <span class="color-box color-battle"></span>
                <label for="filter-battle">Battles</label>
            </div>
            <div class="event-filter">
                <input type="checkbox" id="filter-npc" checked>
                <span class="color-box color-npc"></span>
                <label for="filter-npc">NPC Events</label>
            </div>
        </div>
        
        <div id="calendar-container" class="month-grid">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <div id="timeline-view" class="view">
        <h2>Campaign Timeline</h2>
        <p>A chronological record of major events in the campaign.</p>
        
        <div class="timeline" id="timeline-container">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <div id="characters-view" class="view">
        <h2>Character Sheets</h2>
        <p>The heroes and major NPCs of the campaign.</p>
        
        <div class="character-grid" id="character-container">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <div id="months-view" class="view">
        <h2>Months of the Greyhawk Calendar</h2>
        <p>The Greyhawk calendar consists of 12 months of 28 days each, plus 4 week-long festivals that mark the changing of the seasons.</p>
        
        <div class="month-grid">
            <div class="month-card festival">
                <h3>Needfest (Winter Festival)</h3>
                <p>A week-long festival marking midwinter and the beginning of the new year. Many communities observe this as a time of reflection and renewal.</p>
            </div>
            <div class="month-card">
                <h3>Fireseek</h3>
                <p>The deep winter month when people stay close to their hearths and fires. Named for the constant search for warmth.</p>
            </div>
            <div class="month-card">
                <h3>Readying</h3>
                <p>The late winter month when preparations begin for spring planting and weather begins to moderate.</p>
            </div>
            <div class="month-card">
                <h3>Coldeven</h3>
                <p>The early spring month of transition from winter to spring, when temperatures even out but cool winds still blow.</p>
            </div>
            <div class="month-card festival">
                <h3>Growfest (Spring Festival)</h3>
                <p>The week-long festival celebrating the arrival of spring and the renewal of life.</p>
            </div>
            <div class="month-card">
                <h3>Planting</h3>
                <p>The mid-spring month when most crops are sown and fields prepared.</p>
            </div>
            <div class="month-card">
                <h3>Flocktime</h3>
                <p>The late spring month when animals are gathered into herds and flocks for summer grazing.</p>
            </div>
            <div class="month-card">
                <h3>Wealsun</h3>
                <p>The early summer month when the sun brings wealth to the land with its warmth and light.</p>
            </div>
            <div class="month-card festival">
                <h3>Richfest (Summer Festival)</h3>
                <p>The week-long midsummer festival, celebrated with feasting, tournaments, and marriages.</p>
            </div>
            <div class="month-card">
                <h3>Reaping</h3>
                <p>The mid-summer month when the first harvests begin and fields are rich with crops.</p>
            </div>
            <div class="month-card">
                <h3>Goodmonth</h3>
                <p>The late summer month known for its pleasant weather and abundance.</p>
            </div>
            <div class="month-card">
                <h3>Harvester</h3>
                <p>The early autumn month when the main harvests are gathered.</p>
            </div>
            <div class="month-card festival">
                <h3>Brewfest (Fall Festival)</h3>
                <p>The week-long autumn festival celebrating the harvest, featuring much drinking of new ales and wines.</p>
            </div>
            <div class="month-card">
                <h3>Patchwall</h3>
                <p>The mid-autumn month when preparations for winter begin and buildings are patched against coming cold.</p>
            </div>
            <div class="month-card">
                <h3>Ready'reat</h3>
                <p>The late autumn month when the last preparations for winter are made and final harvests gathered.</p>
            </div>
            <div class="month-card">
                <h3>Sunsebb</h3>
                <p>The early winter month when the sun ebbs its lowest in the sky and daylight grows scarce.</p>
            </div>
        </div>
    </div>

    <div id="holidays-view" class="view">
        <h2>Holidays and Festivals of the Flanaess</h2>
        <p>The people of the Flanaess observe many holidays throughout the year, from solemn religious observances to joyous seasonal celebrations.</p>
        
        <div class="holiday-list" id="holiday-container">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 class="event-title" id="modal-title">Event Title</h2>
            <p class="event-meta" id="modal-date">Date information</p>
            
            <div class="event-tabs">
                <div class="event-tab active" data-tab="summary">Summary</div>
                <div class="event-tab" data-tab="details">Full Details</div>
                <div class="event-tab" data-tab="characters">Characters</div>
                <div class="event-tab" data-tab="maps">Maps & Images</div>
            </div>
            
            <div id="tab-summary" class="tab-content active">
                <div id="modal-summary"></div>
            </div>
            
            <div id="tab-details" class="tab-content">
                <div id="modal-details"></div>
            </div>
            
            <div id="tab-characters" class="tab-content">
                <div id="modal-characters"></div>
            </div>
            
            <div id="tab-maps" class="tab-content">
                <div id="modal-maps"></div>
            </div>
        </div>
    </div>

    <!-- Admin controls for adding/editing content -->
    <button class="admin-toggle" id="admin-toggle">+</button>
    
    <div class="admin-controls" id="admin-panel">
        <h2>Add/Edit Campaign Content</h2>
        
        <div class="admin-section">
            <label for="admin-type">Event Type:</label>
            <select id="admin-type">
                <option value="adventure">Adventure</option>
                <option value="battle">Battle</option>
                <option value="npc-event">NPC Event</option>
                <option value="character">Character Sheet</option>
            </select>
        </div>
        
        <div class="admin-section">
            <label for="admin-title">Title:</label>
            <input type="text" id="admin-title" placeholder="Event or character name">
        </div>
        
        <div class="admin-section" id="date-section">
            <label for="admin-date">Date:</label>
            <select id="admin-year">
                <option value="567">567 CY</option>
                <option value="568">568 CY</option>
                <option value="569" selected>569 CY</option>
            </select>
            <select id="admin-month">
                <!-- Will be populated by JavaScript -->
            </select>
            <select id="admin-day">
                <!-- Will be populated by JavaScript -->
            </select>
        </div>
        
        <div class="admin-section">
            <label for="admin-summary">Summary:</label>
            <textarea id="admin-summary" placeholder="Brief summary or character bio"></textarea>
        </div>
        
        <div class="admin-section">
            <label for="admin-details">Full Details:</label>
            <textarea id="admin-details" placeholder="Full description, adventure recap, or character details"></textarea>
        </div>
        
        <div class="admin-buttons">
            <button class="admin-button save" id="admin-save">Save</button>
            <button class="admin-button" id="admin-cancel">Cancel</button>
            <button class="admin-button delete" id="admin-delete">Delete</button>
        </div>
    </div>

    <footer>
        <p>For use with the Greyhawk Wars campaign. Based on the World of Greyhawk setting created by Gary Gygax.</p>
    </footer>

    <script>
        // Greyhawk Calendar Data
        const GREYHAWK_MONTHS = [
            {name: "Needfest", isFestival: true, description: "Winter Festival marking the new year"},
            {name: "Fireseek", isFestival: false, description: "First month of winter"},
            {name: "Readying", isFestival: false, description: "Second month of winter"},
            {name: "Coldeven", isFestival: false, description: "Third month of winter"},
            {name: "Growfest", isFestival: true, description: "Spring Festival"},
            {name: "Planting", isFestival: false, description: "First month of spring"},
            {name: "Flocktime", isFestival: false, description: "Second month of spring"},
            {name: "Wealsun", isFestival: false, description: "Third month of spring"},
            {name: "Richfest", isFestival: true, description: "Summer Festival"},
            {name: "Reaping", isFestival: false, description: "First month of summer"},
            {name: "Goodmonth", isFestival: false, description: "Second month of summer"},
            {name: "Harvester", isFestival: false, description: "Third month of summer"},
            {name: "Brewfest", isFestival: true, description: "Fall Festival"},
            {name: "Patchwall", isFestival: false, description: "First month of autumn"},
            {name: "Ready'reat", isFestival: false, description: "Second month of autumn"},
            {name: "Sunsebb", isFestival: false, description: "Third month of autumn"}
        ];

        const GREYHAWK_DAYS = [
            "Starday", "Sunday", "Moonday", "Godsday", "Waterday", "Earthday", "Freeday"
        ];

        const GREYHAWK_HOLIDAYS = [
            { name: "Midwinter Night", month: 0, day: 4, description: "The longest night of the year, dedicated to quiet reflection and honoring ancestors." },
            { name: "St. Cuthbert's Day", month: 1, day: 4, description: "Holy day dedicated to St. Cuthbert. Followers gather in temples to hear sermons about duty and responsibility." },
            { name: "Feast of Allitur", month: 2, day: 12, description: "Day of contemplation and wisdom. Scholars and sages exchange knowledge and hold debates." },
            { name: "Day of the Sun", month: 6, day: 14, description: "Celebration of Pelor and the summer sun. Communities hold outdoor festivals with generous feasting." },
            { name: "Midsummer Night", month: 8, day: 4, description: "The shortest night of the year, celebrated with bonfires and dancing till dawn." },
            { name: "Justday", month: 9, day: 10, description: "Day of law and judgment, sacred to Pholtus. Courts make significant rulings and laws are enacted." },
            { name: "Weaverday", month: 11, day: 8, description: "Holiday honoring Boccob, god of magic. Wizards demonstrate magical feats and exchange arcane knowledge." },
            { name: "Dark Night", month: 15, day: 11, description: "Sacred to Nerull, god of death. Most people stay indoors while clerics conduct ceremonies to appease the Lord of Death." }
        ];

        // Campaign specific data
        // Current campaign date
        let CAMPAIGN_DATE = {
            year: 569,
            month: 1, // Fireseek
            day: 15
        };

        // Sample campaign events - in a real implementation, this would be loaded from a database or JSON file
        const CAMPAIGN_EVENTS = [
            {
                id: "event-1",
                title: "Battle of Critwall Bridge",
                type: "battle",
                date: { year: 567, month: 5, day: 18 },
                summary: "Shield Lands forces successfully defended Critwall Bridge against a major assault by Iuz's army, preventing their advance south.",
                details: "The party joined Shield Land knights led by Knight Commander Bredivan in defense of the critical Critwall Bridge. Facing overwhelming numbers, the adventurers held the northern approach while Shield Land forces engaged the main army. Thorgrim's decisive action in collapsing part of the bridge temporarily halted the enemy advance, while Elora's timely healing magic kept the defenders fighting. The battle lasted from dawn until dusk, with Iuz's forces finally retreating after suffering heavy casualties. This victory delayed Iuz's southern campaign by several months and established the party as heroes of the Shield Lands.",
                characters: ["Thorgrim", "Elora", "Knight Commander Bredivan", "Duke Holmer"]
            },
            {
                id: "event-2",
                title: "Discovery of the Ivory Scroll",
                type: "adventure",
                date: { year: 567, month: 8, day: 7 },
                summary: "The party recovered an ancient artifact known as the Ivory Scroll from ruins in the Abbor-Alz mountains.",
                details: "Following clues from the captured Scarlet Brotherhood agent, the party ventured into ancient ruins dating back to the Suel Imperium in the Abbor-Alz mountains. After navigating traps and facing guardian constructs, they discovered the Ivory Scroll, a powerful artifact containing powerful divination magic. The scroll revealed the first hints of Iuz's alliance with Scarlet Brotherhood agents. On their return journey, they were ambushed by a Scarlet Brotherhood strike team led by the assassin Midnight Fist, who escaped after a brief but intense confrontation.",
                characters: ["Thorgrim", "Elora", "Mialee", "Midnight Fist"]
            },
            {
                id: "event-3",
                title: "Fall of Admundfort",
                type: "battle",
                date: { year: 568, month: 2, day: 25 },
                summary: "Iuz's forces overran the island capital of the Shield Lands, marking a major loss for the forces of good.",
                details: "After months of siege, Admundfort finally fell to Iuz's combined armies. The party participated in the desperate evacuation of civilians by ship as the city's outer defenses crumbled. Lady Katarina of the Shield Lands entrusted them with sensitive documents to be delivered to Greyhawk, narrowly escaping as the citadel fell. Reports indicate most of the Knights of Holy Shielding were slain or captured, with Lord Holmer presumably taken prisoner. This defeat marked the effective end of the Shield Lands as an independent nation.",
                characters: ["Thorgrim", "Elora", "Mialee", "Galen", "Lady Katarina", "Lord Holmer"]
            },
            {
                id: "event-4",
                title: "Meeting with the Circle of Eight",
                type: "adventure",
                date: { year: 568, month: 6, day: 14 },
                summary: "The party was summoned to Greyhawk to meet with representatives of the Circle of Eight regarding intelligence on the war.",
                details: "In the Free City of Greyhawk, the party met with Jallarzi Sallavarian and Otto of the Circle of Eight. The mages confirmed the party's suspicions about the Scarlet Brotherhood's involvement with Iuz, despite their seemingly opposed ideologies. The Circle requested the party's help in uncovering the Brotherhood's true intentions. In exchange for the Ivory Scroll, the wizards provided magical assistance and a letter of introduction to the court of Nyrond, where Brotherhood infiltration was suspected. The party also learned that Drawmij of the Circle was missing while investigating rumors in the Pomarj.",
                characters: ["Thorgrim", "Elora", "Mialee", "Galen", "Jallarzi Sallavarian", "Otto"]
            },
            {
                id: "event-5",
                title: "Assassination of King Lynwerd's Advisor",
                type: "npc-event",
                date: { year: 569, month: 0, day: 3 },
                summary: "Lord Saxton, chief advisor to King Lynwerd of Nyrond, was assassinated during Needfest celebrations.",
                details: "During the height of Needfest celebrations in Rel Mord, Lord Saxton was found dead in his chambers. The methodology matched known Scarlet Brotherhood assassination techniques. Court wizard Marakios determined a magical disguise had been used to infiltrate the castle. King Lynwerd immediately increased security and requested aid from allied nations. This marked the beginning of a purge of suspected Brotherhood agents throughout Nyrond.",
                characters: ["King Lynwerd", "Lord Saxton", "Marakios"]
            },
            {
                id: "event-6",
                title: "Discovery of Secret Passages",
                type: "adventure",
                date: { year: 569, month: 1, day: 10 },
                summary: "The party uncovered a network of hidden passages beneath Castle Rel Mord, leading to evidence of a Brotherhood spy ring.",
                details: "Acting on tips from castle staff about strange noises, the party discovered concealed doors leading to a network of passages beneath Castle Rel Mord. Following these tunnels, they encountered magical wards and mechanical traps before confronting a Brotherhood agent named Sivesh. Though they captured him alive, magical poison caused him to perish during interrogation. Documents found in the hidden complex implicated three noble families in Nyrond as Brotherhood collaborators and revealed plans to assassinate King Lynwerd at the upcoming Spring Conclave. The party is now working with loyal elements of the Nyrondese court to verify these accusations before taking action.",
                characters: ["Thorgrim", "Elora", "Mialee", "Galen", "Sivesh", "King Lynwerd"]
            }
        ];

        // Character data
        const CHARACTERS = [
            {
                id: "char-1",
                name: "Thorgrim Ironfist",
                race: "Dwarf",
                class: "Fighter",
                level: 8,
                stats: {
                    str: 18,
                    dex: 12,
                    con: 16,
                    int: 10,
                    wis: 13,
                    cha: 8
                },
                bio: "A stoic dwarf from the Principality of Ulek who took up arms after his clan was driven from their mines by humanoid forces aligned with Turrosh Mak.",
                player: "Mike"
            },
            {
                id: "char-2",
                name: "Elora Silverleaf",
                race: "Elf",
                class: "Cleric of Corellon",
                level: 8,
                stats: {
                    str: 10,
                    dex: 14,
                    con: 12,
                    int: 14,
                    wis: 18,
                    cha: 15
                },
                bio: "A devoted priestess of Corellon from the Vesve Forest, driven to action when Iuz's forces began encroaching on elven territories in the north.",
                player: "Sarah"
            },
            {
                id: "char-3",
                name: "Mialee Starweaver",
                race: "Elf",
                class: "Wizard",
                level: 7,
                stats: {
                    str: 8,
                    dex: 16,
                    con: 10,
                    int: 18,
                    wis: 14,
                    cha: 12
                },
                bio: "A talented evoker from Highfolk who studied under the mages of the Circle of Eight before joining the fight against the rising tide of evil.",
                player: "Jessica"
            },
            {
                id: "char-4",
                name: "Galen Shadowfoot",
                race: "Halfling",
                class: "Rogue",
                level: 7,
                stats: {
                    str: 10,
                    dex: 18,
                    con: 14,
                    int: 13,
                    wis: 12,
                    cha: 14
                },
                bio: "A cunning halfling from the County of Ulek who joined the party after his family's trading caravan was raided by humanoids serving Turrosh Mak.",
                player: "Chris"
            },
            {
                id: "char-5",
                name: "Knight Commander Bredivan",
                race: "Human",
                class: "Paladin",
                level: 10,
                stats: {
                    str: 16,
                    dex: 12,
                    con: 14,
                    int: 12,
                    wis: 14,
                    cha: 16
                },
                bio: "A senior commander of the Knights of Holy Shielding, known for his tactical brilliance and unwavering faith in Heironeous.",
                player: "NPC"
            },
            {
                id: "char-6",
                name: "Midnight Fist",
                race: "Human",
                class: "Monk/Assassin",
                level: 9,
                stats: {
                    str: 14,
                    dex: 18,
                    con: 13,
                    int: 15,
                    wis: 16,
                    cha: 12
                },
                bio: "A deadly Scarlet Brotherhood operative who has clashed with the party multiple times. Recognizable by the scarlet dragon tattoo on her right forearm.",
                player: "NPC Antagonist"
            }
        ];

        /**
         * Converts a Gregorian date to a Greyhawk date
         */
        function gregorianToGreyhawk(date) {
            // Get day of year (0-365)
            const start = new Date(date.getFullYear(), 0, 0);
            const diff = date - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay) - 1; // 0-based day of year
            
            // Calculate Greyhawk date components
            let dayCount = dayOfYear;
            let monthIndex = 0;
            
            // Determine month and day
            while (dayCount >= 0) {
                const daysInMonth = (GREYHAWK_MONTHS[monthIndex].isFestival) ? 7 : 28;
                if (dayCount < daysInMonth) {
                    break;
                }
                dayCount -= daysInMonth;
                monthIndex++;
                
                // Handle year overflow
                if (monthIndex >= GREYHAWK_MONTHS.length) {
                    return { 
                        error: "Date out of range",
                        gregorianDate: date
                    };
                }
            }
            
            // Calculate day of week (0-6)
            const dayOfWeek = Math.floor(dayOfYear % 7);
            
            return {
                year: date.getFullYear(), // Keep the same year number
                month: monthIndex,
                monthName: GREYHAWK_MONTHS[monthIndex].name,
                day: dayCount + 1, // Convert to 1-based day
                dayOfWeek: dayOfWeek,
                weekdayName: GREYHAWK_DAYS[dayOfWeek],
                dayOfYear: dayOfYear,
                isFestival: GREYHAWK_MONTHS[monthIndex].isFestival,
                gregorianDate: date
            };
        }

        /**
         * Converts a Greyhawk date to a Gregorian date
         */
        function greyhawkToGregorian(year, month, day) {
            // Validate inputs
            if (month < 0 || month >= GREYHAWK_MONTHS.length) {
                throw new Error("Invalid Greyhawk month");
            }
            
            const maxDays = GREYHAWK_MONTHS[month].isFestival ? 7 : 28;
            if (day < 1 || day > maxDays) {
                throw new Error("Invalid day for specified Greyhawk month");
            }
            
            // Calculate day of year
            let dayOfYear = 0;
            for (let m = 0; m < month; m++) {
                dayOfYear += GREYHAWK_MONTHS[m].isFestival ? 7 : 28;
            }
            dayOfYear += (day - 1); // Convert from 1-based to 0-based
            
            // Create Gregorian date
            const date = new Date(year, 0, 1);
            date.setDate(date.getDate() + dayOfYear);
            return date;
        }

        /**
         * Finds Greyhawk holidays for a specified date
         */
        function getHolidaysForDate(greyhawkDate) {
            return GREYHAWK_HOLIDAYS.filter(holiday => {
                return (
                    holiday.month === greyhawkDate.month &&
                    holiday.day === greyhawkDate.day
                );
            });
        }

        /**
         * Gets campaign events for a specified date
         */
        function getEventsForDate(year, month, day) {
            return CAMPAIGN_EVENTS.filter(event => {
                return (
                    event.date.year === year &&
                    event.date.month === month &&
                    event.date.day === day
                );
            });
        }

        // UI Functions
        function updateCurrentDate() {
            const dateObj = {
                year: CAMPAIGN_DATE.year,
                month: CAMPAIGN_DATE.month,
                day: CAMPAIGN_DATE.day
            };
            
            const monthName = GREYHAWK_MONTHS[dateObj.month].name;
            const dayOfWeek = calculateDayOfWeek(dateObj.year, dateObj.month, dateObj.day);
            const weekdayName = GREYHAWK_DAYS[dayOfWeek];
            
            let dateString = `Current Campaign Date: ${weekdayName}, ${monthName} ${dateObj.day}, ${dateObj.year} CY`;
            
            // Check for holidays
            const holidays = GREYHAWK_HOLIDAYS.filter(h => h.month === dateObj.month && h.day === dateObj.day);
            if (holidays.length > 0) {
                dateString += ` - ${holidays.map(h => h.name).join(", ")}`;
            }
            
            // Check for campaign events
            const events = getEventsForDate(dateObj.year, dateObj.month, dateObj.day);
            if (events.length > 0) {
                dateString += ` | Active Events: ${events.length}`;
            }
            
            document.getElementById('current-date').innerHTML = dateString;
        }

        /**
         * Calculate day of week for a Greyhawk date
         * Returns 0-6 (0 = Starday, 6 = Freeday)
         */
        function calculateDayOfWeek(year, month, day) {
            // Calculate days since a reference date
            // For simplicity, let's say 1 Needfest 560 CY was a Starday (0)
            
            const referenceYear = 560;
            const daysPerYear = 364; // Greyhawk year has exactly 364 days
            
            // Days from year
            let totalDays = (year - referenceYear) * daysPerYear;
            
            // Days from months
            for (let m = 0; m < month; m++) {
                totalDays += GREYHAWK_MONTHS[m].isFestival ? 7 : 28;
            }
            
            // Days from day of month (1-based to 0-based)
            totalDays += (day - 1);
            
            // Return day of week (mod 7)
            return totalDays % 7;
        }

        function buildCalendarYear(year) {
            const container = document.getElementById('calendar-container');
            container.innerHTML = ''; // Clear previous content
            
            // Update displayed year
            document.getElementById('display-year').textContent = year + ' CY';
            
            // Create a month card for each Greyhawk month
            GREYHAWK_MONTHS.forEach((month, monthIndex) => {
                const monthCard = document.createElement('div');
                monthCard.className = `month-card ${month.isFestival ? 'festival' : ''}`;
                
                const monthTitle = document.createElement('h3');
                monthTitle.textContent = month.name;
                monthCard.appendChild(monthTitle);
                
                // Add weekday headers
                const calendarGrid = document.createElement('div');
                calendarGrid.className = 'calendar-grid';
                
                GREYHAWK_DAYS.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'day-header';
                    dayHeader.textContent = day.substring(0, 3); // Abbreviate
                    calendarGrid.appendChild(dayHeader);
                });
                
                // Calculate first day of week for this month
                const firstDayOfWeek = calculateDayOfWeek(year, monthIndex, 1);
                
                // Add empty cells for days before the first of the month
                for (let i = 0; i < firstDayOfWeek; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    calendarGrid.appendChild(emptyDay);
                }
                
                // Add actual days
                const daysInMonth = month.isFestival ? 7 : 28;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day';
                    
                    // Check if this is the current campaign date
                    if (year === CAMPAIGN_DATE.year && 
                        monthIndex === CAMPAIGN_DATE.month && 
                        day === CAMPAIGN_DATE.day) {
                        dayCell.classList.add('current-day');
                    }
                    
                    // Add the day number
                    dayCell.textContent = day;
                    
                    // Check for holidays
                    const holidays = GREYHAWK_HOLIDAYS.filter(h => 
                        h.month === monthIndex && h.day === day);
                    
                    if (holidays.length > 0 && document.getElementById('filter-holiday').checked) {
                        dayCell.classList.add('holiday');
                        dayCell.title = holidays.map(h => h.name).join(', ');
                    }
                    
                    // Check for campaign events
                    const events = getEventsForDate(year, monthIndex, day);
                    
                    if (events.length > 0) {
                        // Add markers for each event type
                        const eventsByType = {
                            'adventure': 0,
                            'battle': 0,
                            'npc-event': 0
                        };
                        
                        events.forEach(event => {
                            eventsByType[event.type]++;
                        });
                        
                        // Add event markers
                        if (eventsByType.adventure > 0 && document.getElementById('filter-adventure').checked) {
                            dayCell.classList.add('adventure');
                            const marker = document.createElement('div');
                            marker.className = 'day-marker adventure-marker';
                            dayCell.appendChild(marker);
                        }
                        
                        if (eventsByType.battle > 0 && document.getElementById('filter-battle').checked) {
                            dayCell.classList.add('battle');
                            const marker = document.createElement('div');
                            marker.className = 'day-marker battle-marker';
                            dayCell.appendChild(marker);
                        }
                        
                        if (eventsByType['npc-event'] > 0 && document.getElementById('filter-npc').checked) {
                            dayCell.classList.add('npc-event');
                            const marker = document.createElement('div');
                            marker.className = 'day-marker npc-marker';
                            dayCell.appendChild(marker);
                        }
                        
                        // Add click handler to open event details
                        dayCell.addEventListener('click', function() {
                            showEventDetails(events[0]); // Show first event for simplicity
                        });
                    }
                    
                    calendarGrid.appendChild(dayCell);
                }
                
                monthCard.appendChild(calendarGrid);
                container.appendChild(monthCard);
            });
        }

        function buildTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = ''; // Clear previous content
            
            // Sort events by date
            const sortedEvents = [...CAMPAIGN_EVENTS].sort((a, b) => {
                if (a.date.year !== b.date.year) {
                    return a.date.year - b.date.year;
                }
                if (a.date.month !== b.date.month) {
                    return a.date.month - b.date.month;
                }
                return a.date.day - b.date.day;
            });
            
            // Create timeline items
            sortedEvents.forEach((event, index) => {
                const timelineItem = document.createElement('div');
                timelineItem.className = `timeline-container ${index % 2 === 0 ? 'timeline-left' : 'timeline-right'}`;
                
                const content = document.createElement('div');
                content.className = 'timeline-content';
                
                const title = document.createElement('h3');
                title.textContent = event.title;
                
                const dateStr = document.createElement('div');
                dateStr.className = 'event-date';
                dateStr.textContent = `${GREYHAWK_MONTHS[event.date.month].name} ${event.date.day}, ${event.date.year} CY`;
                
                const summary = document.createElement('p');
                summary.textContent = event.summary;
                
                // Add visual indicator for event type
                content.classList.add(event.type);
                
                content.appendChild(title);
                content.appendChild(dateStr);
                content.appendChild(summary);
                
                // Add click handler
                content.addEventListener('click', function() {
                    showEventDetails(event);
                });
                
                timelineItem.appendChild(content);
                container.appendChild(timelineItem);
            });
        }

        function buildCharacterList() {
            const container = document.getElementById('character-container');
            container.innerHTML = ''; // Clear previous content
            
            // Create character cards
            CHARACTERS.forEach(character => {
                const charCard = document.createElement('div');
                charCard.className = 'character-card';
                
                const header = document.createElement('h3');
                header.textContent = character.name;
                
                const raceCls = document.createElement('p');
                raceCls.textContent = `${character.race} ${character.class} (Level ${character.level})`;
                
                const stats = document.createElement('div');
                stats.className = 'character-stats';
                
                // Add ability scores
                for (const [key, value] of Object.entries(character.stats)) {
                    const stat = document.createElement('div');
                    stat.className = 'character-stat';
                    
                    const statName = document.createElement('span');
                    statName.textContent = key.toUpperCase();
                    
                    const statValue = document.createElement('span');
                    statValue.textContent = value;
                    
                    stat.appendChild(statName);
                    stat.appendChild(statValue);
                    stats.appendChild(stat);
                }
                
                const bio = document.createElement('p');
                bio.className = 'character-bio';
                bio.textContent = character.bio;
                
                const player = document.createElement('p');
                player.textContent = `Player: ${character.player}`;
                
                charCard.appendChild(header);
                charCard.appendChild(raceCls);
                charCard.appendChild(stats);
                charCard.appendChild(bio);
                charCard.appendChild(player);
                
                container.appendChild(charCard);
            });
        }

        function buildHolidayList() {
            const container = document.getElementById('holiday-container');
            container.innerHTML = ''; // Clear previous content
            
            // Sort holidays by date
            const sortedHolidays = [...GREYHAWK_HOLIDAYS].sort((a, b) => {
                if (a.month !== b.month) {
                    return a.month - b.month;
                }
                return a.day - b.day;
            });
            
            // Create list of holidays
            sortedHolidays.forEach(holiday => {
                const holidayItem = document.createElement('div');
                holidayItem.className = 'holiday-item';
                
                const holidayTitle = document.createElement('h3');
                holidayTitle.textContent = holiday.name;
                
                const holidayDate = document.createElement('p');
                holidayDate.className = 'holiday-date';
                holidayDate.textContent = `${GREYHAWK_MONTHS[holiday.month].name} ${holiday.day}`;
                
                const holidayDescription = document.createElement('p');
                holidayDescription.textContent = holiday.description;
                
                holidayItem.appendChild(holidayTitle);
                holidayItem.appendChild(holidayDate);
                holidayItem.appendChild(holidayDescription);
                container.appendChild(holidayItem);
            });
        }

        // Modal functions
        function showEventDetails(event) {
            // Update modal content
            document.getElementById('modal-title').textContent = event.title;
            document.getElementById('modal-date').textContent = 
                `${GREYHAWK_MONTHS[event.date.month].name} ${event.date.day}, ${event.date.year} CY`;
            
            document.getElementById('modal-summary').innerHTML = `<p>${event.summary}</p>`;
            document.getElementById('modal-details').innerHTML = `<p>${event.details}</p>`;
            
            // Update characters tab
            const charContent = document.getElementById('modal-characters');
            charContent.innerHTML = '';
            
            if (event.characters && event.characters.length > 0) {
                event.characters.forEach(charName => {
                    const character = CHARACTERS.find(c => c.name === charName);
                    if (character) {
                        const charCard = document.createElement('div');
                        charCard.className = 'character-card';
                        
                        const header = document.createElement('h3');
                        header.textContent = character.name;
                        
                        const raceCls = document.createElement('p');
                        raceCls.textContent = `${character.race} ${character.class} (Level ${character.level})`;
                        
                        charCard.appendChild(header);
                        charCard.appendChild(raceCls);
                        charContent.appendChild(charCard);
                    } else {
                        const charItem = document.createElement('p');
                        charItem.textContent = charName;
                        charContent.appendChild(charItem);
                    }
                });
            } else {
                charContent.innerHTML = '<p>No character information available for this event.</p>';
            }
            
            // Update maps tab
            document.getElementById('modal-maps').innerHTML = 
                '<p>No maps or images available for this event.</p>';
            
            // Show the modal
            document.getElementById('event-modal').style.display = 'block';
        }

        function populateAdminMonthSelect() {
            const select = document.getElementById('admin-month');
            select.innerHTML = ''; // Clear existing options
            
            GREYHAWK_MONTHS.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = month.name;
                select.appendChild(option);
            });
            
            // Update days when month changes
            select.addEventListener('change', updateAdminDaySelect);
            
            // Initialize days
            updateAdminDaySelect();
        }

        function updateAdminDaySelect() {
            const monthSelect = document.getElementById('admin-month');
            const daySelect = document.getElementById('admin-day');
            const selectedMonth = parseInt(monthSelect.value);
            
            daySelect.innerHTML = ''; // Clear existing options
            
            const daysInMonth = GREYHAWK_MONTHS[selectedMonth].isFestival ? 7 : 28;
            for (let day = 1; day <= daysInMonth; day++) {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                daySelect.appendChild(option);
            }
        }

        // Toggle between views
        function setupTabButtons() {
            const buttons = [
                {id: 'btn-calendar', view: 'calendar-view'},
                {id: 'btn-timeline', view: 'timeline-view'},
                {id: 'btn-characters', view: 'characters-view'},
                {id: 'btn-months', view: 'months-view'},
                {id: 'btn-holidays', view: 'holidays-view'}
            ];
            
            buttons.forEach(button => {
                document.getElementById(button.id).addEventListener('click', function() {
                    // Update button states
                    buttons.forEach(b => {
                        document.getElementById(b.id).classList.remove('active');
                        document.getElementById(b.view).classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    document.getElementById(button.view).classList.add('active');
                });
            });
        }

        function setupEventTabs() {
            const tabs = document.querySelectorAll('.event-tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Update tab states
                    document.querySelectorAll('.event-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    document.querySelectorAll('.tab-content').forEach(c => {
                        c.classList.remove('active');
                    });
                    
                    // Activate selected tab
                    this.classList.add('active');
                    const tabName = this.getAttribute('data-tab');
                    document.getElementById(`tab-${tabName}`).classList.add('active');
                });
            });
        }

        function setupModal() {
            const modal = document.getElementById('event-modal');
            const closeBtn = document.querySelector('.close');
            
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        function setupEventFilters() {
            const filters = [
                'filter-holiday',
                'filter-adventure',
                'filter-battle',
                'filter-npc'
            ];
            
            filters.forEach(filter => {
                document.getElementById(filter).addEventListener('change', function() {
                    buildCalendarYear(parseInt(document.getElementById('display-year').textContent));
                });
            });
        }

        function setupYearNavigation() {
            document.getElementById('prev-year').addEventListener('click', function() {
                const currentYear = parseInt(document.getElementById('display-year').textContent);
                buildCalendarYear(currentYear - 1);
            });
            
            document.getElementById('next-year').addEventListener('click', function() {
                const currentYear = parseInt(document.getElementById('display-year').textContent);
                buildCalendarYear(currentYear + 1);
            });
        }

        function setupAdminPanel() {
            const adminToggle = document.getElementById('admin-toggle');
            const adminPanel = document.getElementById('admin-panel');
            
            adminToggle.addEventListener('click', function() {
                adminPanel.classList.toggle('visible');
                adminToggle.textContent = adminPanel.classList.contains('visible') ? '×' : '+';
            });
            
            document.getElementById('admin-type').addEventListener('change', function() {
                const type = this.value;
                const dateSection = document.getElementById('date-section');
                
                // Show date section for events, hide for characters
                dateSection.style.display = type === 'character' ? 'none' : 'block';
            });
            
            document.getElementById('admin-save').addEventListener('click', function() {
                saveContentToLocalStorage();
                adminPanel.classList.remove('visible');
                adminToggle.textContent = '+';
                
                // Refresh displayed data
                buildCalendarYear(parseInt(document.getElementById('display-year').textContent));
                buildTimeline();
                buildCharacterList();
            });
            
            document.getElementById('admin-cancel').addEventListener('click', function() {
                adminPanel.classList.remove('visible');
                adminToggle.textContent = '+';
            });
        }

        function saveContentToLocalStorage() {
            const type = document.getElementById('admin-type').value;
            const title = document.getElementById('admin-title').value;
            const summary = document.getElementById('admin-summary').value;
            const details = document.getElementById('admin-details').value;
            
            if (!title || !summary) {
                alert('Title and summary are required!');
                return;
            }
            
            if (type === 'character') {
                // Add new character
                const newChar = {
                    id: 'char-' + (CHARACTERS.length + 1),
                    name: title,
                    race: 'Unknown',
                    class: 'Unknown',
                    level: 1,
                    stats: {
                        str: 10, dex: 10, con: 10,
                        int: 10, wis: 10, cha: 10
                    },
                    bio: summary,
                    player: 'Unknown'
                };
                
                CHARACTERS.push(newChar);
                localStorage.setItem('greyhawk-characters', JSON.stringify(CHARACTERS));
            } else {
                // Add new event
                const year = parseInt(document.getElementById('admin-year').value);
                const month = parseInt(document.getElementById('admin-month').value);
                const day = parseInt(document.getElementById('admin-day').value);
                
                const newEvent = {
                    id: 'event-' + (CAMPAIGN_EVENTS.length + 1),
                    title: title,
                    type: type,
                    date: { year, month, day },
                    summary: summary,
                    details: details,
                    characters: []
                };
                
                CAMPAIGN_EVENTS.push(newEvent);
                localStorage.setItem('greyhawk-events', JSON.stringify(CAMPAIGN_EVENTS));
            }
        }

        function loadContentFromLocalStorage() {
            const savedEvents = localStorage.getItem('greyhawk-events');
            if (savedEvents) {
                // Merge with existing events
                const parsedEvents = JSON.parse(savedEvents);
                
                // Check for duplicates by ID
                parsedEvents.forEach(event => {
                    if (!CAMPAIGN_EVENTS.some(e => e.id === event.id)) {
                        CAMPAIGN_EVENTS.push(event);
                    }
                });
            }
            
            const savedCharacters = localStorage.getItem('greyhawk-characters');
            if (savedCharacters) {
                // Merge with existing characters
                const parsedCharacters = JSON.parse(savedCharacters);
                
                // Check for duplicates by ID
                parsedCharacters.forEach(character => {
                    if (!CHARACTERS.some(c => c.id === character.id)) {
                        CHARACTERS.push(character);
                    }
                });
            }
            
            // Load saved campaign date
            const savedDate = localStorage.getItem('greyhawk-campaign-date');
            if (savedDate) {
                CAMPAIGN_DATE = JSON.parse(savedDate);
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved content first
            loadContentFromLocalStorage();
            
            // Initialize UI
            updateCurrentDate();
            populateAdminMonthSelect();
            buildCalendarYear(CAMPAIGN_DATE.year);
            buildTimeline();
            buildCharacterList();
            buildHolidayList();
            
            setupTabButtons();
            setupEventTabs();
            setupModal();
            setupEventFilters();
            setupYearNavigation();
            setupAdminPanel();
            
            // Save current campaign date to local storage when page closes
            window.addEventListener('beforeunload', function() {
                localStorage.setItem('greyhawk-campaign-date', JSON.stringify(CAMPAIGN_DATE));
            });
        });
